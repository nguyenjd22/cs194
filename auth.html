<!DOCTYPE HTML>
<html>
  <head>
    CLOWN HOURS
  </head>
  <body>
    This is just a test page for getting authorization
    <script>
      // TODO: make sure this works hehe
      var vars = {};
      var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
      });
      var codeGet = vars["code"]
      alert(codeGet)

      // Send a POST request to get access token with the code given from authorization
      const params = {
        client_id: value1,
        client_secret: value2,
        code: codeGet,
        grant_type: "authorization_code",
        redirect_uri: "https://roundaround2022.su.domains/",
      };

      const options = {
        method: 'POST',
        body: JSON.stringify( params )
      };

      var access_token, user_id = ""
      fetch( 'https://api.instagram.com/oauth/access_token', options )
      .then( response => response.json() )
      .then( response => {
          access_token = response["access_token"];
          user_id = response["user_id"];
      });

      // Send a fetch GET request
      // TODO: if errors, we omitted api_version
      var data = []
      var url = 'https://graph.instagram.com/' + user_id + '/media?access_token=' + access_token
      fetch( url )
      .then( response => response.json() )
      .then( response => {
          data = response["data"];
      } );

      var media_id = response["data"]["id"]
      var permalink = ""
      var media_url = 'https://graph.instagram.com/' + media_id + '/media?fields=id,media_type,permalink,username,timestamp&access_token=' + access_token
      fetch( media_url )
      .then( response => response.json() )
      .then( response => {
          permalink = response["permalink"];
      } );

      // loop over each id, send a request to that id and see if it's within timestamp
      // get location via python instagram library

    </script>
    <img src=permalink>
</html>
